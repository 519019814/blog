<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h5>账户余额是 <span id="amount">&&&amount&&&</span></h5>
    <button id="button">打钱</button>
    <script>
        button.addEventListener('click', (e) => {
                // let script = document.createElement('script')
                // let qwer = 'qwer' + parseInt(Math.random() * 10000,10)
                // window[qwer] = function (result) {
                //     alert('被调用的前端函数')
                //     alert(`${result}`)
                //     amount.innerText -= 1
                // }
                // document.body.appendChild(script)
                // script.src = "/pay?callback=" + qwer
                // script.onload = function (e) {
                //     e.currentTarget.remove()
                //     delete window[qwer]
                // }
                // script.onerror = function (e) {
                //     alert('fail')
                //     e.currentTarget.remove()
                //     delete window[qwer]

                // }







                let script = document.createElement('script')
                document.body.appendChild(script)
                let callName = 'jquery' + parseInt(Math.random() * 100000, 10)
                script.src = '/pay?callback=' + callName
                window[callName] = function () {
                    alert('success')
                    amount.innerText -= 1
                }
                script.onload = function (e) {
                    e.currentTarget.remove()
                    delete window[callName]
                }






                // let image = document.createElement('img')
                // image.src = '/pay'
                // image.onload = function (){
                //     alert('打钱成功')
                //     amount.innerText -= 1
                // }
                // image.onerror = functio n (){
                //     alert('打钱失败')
                // }
            })        
    </script>
</body>
</html>